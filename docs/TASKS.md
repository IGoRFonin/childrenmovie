## План разработки "Детский Кинозал"

### Этап 1: Настройка проекта и зависимостей

*   **Задача 1.1: Добавление зависимостей.**
    *   Открой файл `build.gradle.kts` (в модуле `app`).
    *   В блок `dependencies` добавь библиотеки:
        *   **UI:** Jetpack Compose (BOM, UI, Material3, Tooling), ViewModel, Navigation Compose.
        *   **Сеть и парсинг:** OkHttp, Moshi, Jsoup.
        *   **Изображения:** Coil for Compose.
        *   **Видео:** ExoPlayer.
        *   **Асинхронность:** Kotlin Coroutines.

*   **Задача 1.2: Настройка разрешений.**
    *   Открой `app/src/main/AndroidManifest.xml`.
    *   Добавь разрешение на доступ в интернет: `<uses-permission android:name="android.permission.INTERNET" />`.

*   **Задача 1.3: Создание структуры пакетов.**
    *   В папке `.../app/src/main/java/com/yourpackage` создай базовые пакеты в соответствии с архитектурой:
        *   `data`
        *   `ui`
        *   `model`

### Этап 2: Реализация слоя данных (Data Layer)

*   **Задача 2.1: Создание data-классов.**
    *   В пакете `model` создай Kotlin data-классы, точно повторяющие структуру твоего JSON-файла (`ContentItem`, `Series`, `Movie`, `Episode`). Используй аннотации `@Json` от Moshi, если имена полей в Kotlin отличаются от JSON.

*   **Задача 2.2: Реализация `RemoteDataSource`.**
    *   В пакете `data` создай класс `RemoteDataSource`.
    *   Реализуй в нем два публичных `suspend`-метода:
        1.  `fetchContent(url: String): String` — скачивает JSON-файл по URL с помощью `OkHttp` и возвращает его как строку.
        2.  `fetchVideoUrl(pageUrl: String): String` — скачивает HTML-страницу с `ok.ru`, парсит ее с помощью `Jsoup` и возвращает прямую ссылку на видео.

*   **Задача 2.3: Реализация `LocalDataSource`.**
    *   В пакете `data` создай класс `LocalDataSource`.
    *   Реализуй два метода для работы с кешем:
        1.  `saveContent(json: String)` — сохраняет строку с JSON во внутренний файл приложения.
        2.  `loadContent(): String?` — читает JSON из файла и возвращает его.

*   **Задача 2.4: Реализация `Repository`.**
    *   В пакете `data` создай класс `ContentRepository`.
    *   Он должен принимать в конструкторе `RemoteDataSource` и `LocalDataSource`.
    *   Реализуй основной метод `getContent(): Flow<List<ContentItem>>`, который будет выполнять логику "сначала кеш, потом сеть".

### Этап 3: Реализация UI (Главный экран и список серий)

*   **Задача 3.1: Создание UI-компонентов.**
    *   В пакете `ui` создай файл `GalleryScreen.kt`.
    *   Создай `@Composable` функцию `ContentPosterItem` для отображения одного постера с названием.
    *   Создай `@Composable` функцию `GalleryGrid` для отображения сетки (`LazyVerticalGrid`) из этих постеров.

*   **Задача 3.2: Создание `GalleryViewModel`.**
    *   В пакете `ui` создай класс `GalleryViewModel`, наследуемый от `ViewModel`.
    *   Внедри в него `ContentRepository`.
    *   Создай `StateFlow` для хранения состояния экрана (загрузка, ошибка, список контента).
    *   Напиши функцию, которая запускает получение данных из репозитория и обновляет `StateFlow`.

*   **Задача 3.3: Настройка навигации.**
    *   Настрой Jetpack Compose Navigation. Определи маршруты (`"gallery"`, `"series_details/{seriesId}"`, `"player/{pageUrl}"`).
    *   В `MainActivity` настрой `NavHost`.

*   **Задача 3.4: Создание экрана со списком серий.**
    *   По аналогии с главным экраном, создай `SeriesDetailsScreen.kt` и `SeriesDetailsViewModel`.
    *   ViewModel должен принимать `seriesId` из аргументов навигации, запрашивать у репозитория данные по этому ID и отображать список серий.

### Этап 4: Интеграция видеоплеера

*   **Задача 4.1: Создание экрана плеера.**
    *   В пакете `ui` создай `PlayerScreen.kt`.
    *   Внутри используй `AndroidView` composable для интеграции `PlayerView` из ExoPlayer.

*   **Задача 4.2: Создание `PlayerViewModel`.**
    *   Создай `PlayerViewModel`, который принимает `pageUrl` из аргументов навигации.
    *   В `ViewModel` вызови метод репозитория для получения прямой ссылки на видео.
    *   Сохрани полученную ссылку в `StateFlow`.

*   **Задача 4.3: Логика работы плеера.**
    *   В `PlayerScreen` подпишись на `StateFlow` из `ViewModel`.
    *   Когда приходит ссылка, инициализируй `ExoPlayer`, передай ему ссылку и начни воспроизведение.
    *   Не забудь правильно управлять жизненным циклом плеера (ставить на паузу при сворачивании, освобождать ресурсы при закрытии экрана).

### Этап 5: Настройки и завершение

*   **Задача 5.1: Создание экрана настроек.**
    *   Создай простой экран `SettingsScreen.kt` с полем для ввода URL и кнопкой "Сохранить".

*   **Задача 5.2: Реализация сохранения настроек.**
    *   Создай простой класс `SettingsManager` (можно использовать `SharedPreferences`) для сохранения и чтения URL JSON-файла.
    *   Подключи его к `SettingsViewModel` и `ContentRepository`.

*   **Задача 5.3: Реализация PIN-кода.**
    *   Создай `Composable` функцию для диалога с вводом PIN-кода.
    *   Покажи этот диалог перед переходом на экран настроек.

*   **Задача 5.4: Финальная полировка.**
    *   Добавь индикаторы загрузки (`CircularProgressIndicator`) на экраны, пока данные грузятся.
    *   Отображай сообщения об ошибках, если сеть недоступна или JSON невалиден.
    *   В `AndroidManifest.xml` задай принудительную ландшафтную ориентацию (`android:screenOrientation="landscape"`).
    *   Включи полноэкранный режим (immersive mode).
    *   Добавь иконку приложения.
