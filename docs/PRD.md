## PRD: Приложение "Детский Кинозал"

### 1. Введение

*   **Название проекта:** Детский Кинозал
*   **Концепция:** Изолированное и безопасное Android-приложение для детей, предоставляющее доступ к заранее одобренному родителями списку мультсериалов и фильмов. Приложение полностью контролируется через удаленный JSON-файл, исключает рекламу, рекомендации и внешние ссылки.
*   **Целевая аудитория:**
    *   **Пользователь:** Ребенок (3-10 лет).
    *   **Администратор:** Родитель.

### 2. Пользовательские истории

*   **Как родитель, я хочу:**
    *   Управлять всем доступным контентом (сериалами и отдельными фильмами) через один JSON-файл.
    *   Быть уверенным, что ребенок находится в безопасной среде и не может получить доступ к другим функциям планшета.
    *   Защитить настройки приложения PIN-кодом.

*   **Как ребенок, я хочу:**
    *   Видеть на главном экране все доступные мультики.
    *   Выбрать мультсериал и увидеть список его серий.
    *   Выбрать серию или отдельный мультфильм и сразу начать просмотр.
    *   Легко управлять плеером (пауза/воспроизведение) и возвращаться к списку.

### 3. Функциональные требования

#### 3.1. Структура данных (JSON-файл)

Приложение получает данные из JSON-файла следующей структуры:

```json
{
  "version": 1.1,
  "content": [
    {
      "type": "series",
      "id": "fixiki",
      "title": "Фиксики",
      "posterUrl": "https://example.com/posters/fixiki_series.jpg",
      "description": "Мультсериал о маленьких человечках...",
      "episodes": [
        {
          "id": "fixiki_s1e1",
          "title": "Серия 1: Сифон",
          "pageUrl": "https://ok.ru/video/11111"
        },
        {
          "id": "fixiki_s1e2",
          "title": "Серия 2: Компакт-диск",
          "pageUrl": "https://ok.ru/video/22222"
        }
      ]
    },
    {
      "type": "movie",
      "id": "snegurochka_1952",
      "title": "Снегурочка",
      "posterUrl": "https://example.com/posters/snegurochka.jpg",
      "description": "Советский полнометражный мультфильм 1952 года.",
      "pageUrl": "https://ok.ru/video/44444"
    }
  ]
}
```

#### 3.2. Экраны и Навигация

**Экран 1: Главная галерея**

*   Отображает единую сетку всего контента (`content`) из JSON-файла.
*   Каждый элемент сетки состоит из постера (`posterUrl`) и названия (`title`).
*   **Логика навигации:**
    *   При нажатии на элемент с `type: "series"` -> переход на Экран 2 (Список эпизодов).
    *   При нажатии на элемент с `type: "movie"` -> переход на Экран 3 (Плеер).

**Экран 2: Список эпизодов**

*   Отображается при выборе сериала.
*   В верхней части экрана — постер и название сериала.
*   Ниже — вертикальный прокручиваемый список эпизодов (`episodes`).
*   Каждый элемент списка содержит название эпизода (`episodes.title`).
*   Присутствует кнопка "Назад" для возврата на Экран 1.
*   **Логика навигации:**
    *   При нажатии на любой эпизод -> переход на Экран 3 (Плеер).

**Экран 3: Встроенный плеер (ExoPlayer)**

*   Открывается для воспроизведения фильма или эпизода.
*   При запуске отображает индикатор загрузки, пока происходит парсинг `pageUrl` и подготовка видео.
*   Воспроизведение происходит внутри приложения с помощью ExoPlayer.
*   **Интерфейс плеера:**
    *   Кнопка Play/Pause.
    *   Полоса прокрутки (Timeline).
    *   Кнопка "Назад" для возврата на предыдущий экран (Экран 1 или 2).
    *   Все остальные элементы управления плеером скрыты.

**Экран 4: Экран настроек (для родителя)**

*   **Доступ:** Скрытый (например, долгое нажатие на заголовок на главном экране).
*   **Защита:** Перед входом запрашивается 4-значный PIN-код.
*   **Содержимое:**
    *   Поле ввода для URL JSON-файла.
    *   Кнопка "Сохранить и обновить".
    *   Кнопка "Очистить кеш".

#### 3.3. Логика получения данных

1.  При запуске приложение отображает данные из локального кеша (если он есть).
2.  Параллельно отправляется сетевой запрос на URL из настроек для получения свежего JSON.
3.  Если полученный JSON новее (сравнивается поле `version`), кеш обновляется, и экран плавно перезагружает данные.
4.  При отсутствии сети и кеша отображается сообщение об ошибке.

#### 3.4. Логика воспроизведения видео

1.  Пользователь выбирает контент для просмотра.
2.  Приложение берет `pageUrl` из соответствующего объекта JSON.
3.  Отправляется HTTP GET-запрос на `pageUrl`.
4.  HTML-ответ страницы парсится для извлечения прямой ссылки на видеофайл (.mp4, .m3u8).
5.  Извлеченная ссылка передается во встроенный ExoPlayer для воспроизведения.

### 4. Нефункциональные требования

*   **Производительность:** Асинхронная загрузка и кеширование изображений для плавной прокрутки. Быстрый запуск приложения за счет кеширования данных.
*   **UI/UX:**
    *   Приложение работает в полноэкранном режиме (immersive mode) для предотвращения случайного выхода.
    *   Принудительная ландшафтная (альбомная) ориентация на всех экранах.
    *   Наличие индикаторов загрузки при сетевых операциях.
*   **Безопасность:** Доступ к настройкам защищен PIN-кодом.

### 5. Технологический стек

*   **Язык:** Kotlin
*   **UI:** Jetpack Compose
*   **Архитектура:** MVVM (ViewModel, StateFlow)
*   **Асинхронность:** Kotlin Coroutines
*   **Сеть:** OkHttp
*   **Парсинг JSON:** Moshi
*   **Парсинг HTML:** Jsoup
*   **Загрузка изображений:** Coil
*   **Видео плеер:** ExoPlayer

### 6. Риски

*   **Зависимость от верстки:** Изменение HTML-структуры страниц `ok.ru` приведет к поломке парсера видеоссылок.
*   **Блокировка:** Сервис `ok.ru` может блокировать автоматические запросы от приложения.
*   **Недоступность контента:** Видео по ссылкам могут быть удалены или стать приватными.
