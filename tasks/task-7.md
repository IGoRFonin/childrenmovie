# Task 7: –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞–ª–æ–∂–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø–ª–µ–µ—Ä–∞

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø–ª–µ–µ—Ä–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–∏–∑—É–∞–ª—å–Ω—ã–π –±–∞–≥: –ø–ª–µ–µ—Ä –Ω–µ —É—Å–ø–µ–≤–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä—ã—Ç—å—Å—è, –∞ UI –≥–ª–∞–≤–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ —É–∂–µ –Ω–∞—á–∏–Ω–∞–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –Ω–∞–ª–æ–∂–µ–Ω–∏—é –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤.

### –°–∏–º–ø—Ç–æ–º—ã
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —ç–ª–µ–º–µ–Ω—Ç—ã –ø–ª–µ–µ—Ä–∞ –∏ –≥–ª–∞–≤–Ω–æ–π –≥–∞–ª–µ—Ä–µ–∏
- –ü–µ—Ä–µ—Ö–æ–¥ –≤—ã–≥–ª—è–¥–∏—Ç "—Ä–≤–∞–Ω—ã–º" –∏ –Ω–µ–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º
- –£—Ö—É–¥—à–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç

### –ü—Ä–∏—á–∏–Ω–∞
–ü—Ä–∏ –≤—ã–∑–æ–≤–µ `navController.popBackStack()` –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ - Jetpack Navigation —Å—Ä–∞–∑—É —É–¥–∞–ª—è–µ—Ç –ø–ª–µ–µ—Ä–Ω—ã–π —ç–∫—Ä–∞–Ω –∏–∑ —Å—Ç–µ–∫–∞ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏–π. ExoPlayer –Ω–µ —É—Å–ø–µ–≤–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Å–≤–æ–±–æ–¥–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã –∏ —Å–∫—Ä—ã—Ç—å—Å—è –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –ø–æ—è–≤–∏—Ç—Å—è –Ω–æ–≤—ã–π UI.

## –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –§–∞–π–ª: `MainActivity.kt:240-257`

```kotlin
when (val state = uiState) {
    is PlayerUiState.Loading -> {
        Box(
            contentAlignment = Alignment.Center,
            modifier = Modifier.fillMaxSize().background(Color.Black)
        ) {
            CircularProgressIndicator()
        }
    }
    is PlayerUiState.Success -> {
        PlayerScreen(videoUrl = state.videoUrl, pageUrl = state.pageUrl)
    }
    is PlayerUiState.Error -> {
        Box(contentAlignment = Alignment.Center, modifier = Modifier.fillMaxSize()) {
            Text("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ: ${state.message}")
        }
    }
}
```

### –§–∞–π–ª: `PlayerScreen.kt:105-112`

```kotlin
DisposableEffect(Unit) {
    onDispose {
        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        handler.removeCallbacksAndMessages(null)
        // –û—á–µ–Ω—å –≤–∞–∂–Ω–æ –æ—Å–≤–æ–±–æ–¥–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã –ø–ª–µ–µ—Ä–∞!
        exoPlayer.release()
    }
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** `onDispose` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ Composable –∏–∑ –¥–µ—Ä–µ–≤–∞, –Ω–æ UI —É–∂–µ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ –¥—Ä—É–≥–æ–π —ç–∫—Ä–∞–Ω –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.

---

## –¶–µ–ª–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –†–µ—à–µ–Ω–∏–µ: –û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è —Å —Ñ–∞–∑–æ–π –∑–∞–∫—Ä—ã—Ç–∏—è

**–°—É—Ç—å:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `Closing` –≤ UI –ø–ª–µ–µ—Ä–∞, –∫–æ—Ç–æ—Ä–æ–µ:
1. –°–∫—Ä—ã–≤–∞–µ—Ç –≤–∏–¥–µ–æ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —á–µ—Ä–Ω—ã–π —ç–∫—Ä–∞–Ω)
2. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø–ª–µ–µ—Ä
3. –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ä–µ—Å—É—Ä—Å—ã
4. –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª—è–µ—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏—é –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞

### –ù–æ–≤—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

```kotlin
sealed interface PlayerUiState {
    object Loading : PlayerUiState
    data class Success(val videoUrl: String, val pageUrl: String) : PlayerUiState
    object Closing : PlayerUiState  // –ù–û–í–û–ï: –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è —Ñ–∞–∑–∞ –∑–∞–∫—Ä—ã—Ç–∏—è
    data class Error(val message: String) : PlayerUiState
}
```

---

## –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ö–∞–Ω–∏–∑–º–∞ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ –≤ PlayerScreen

**–§–∞–π–ª:** `PlayerScreen.kt`

#### 1.1 –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä callback

```kotlin
@Composable
fun PlayerScreen(
    videoUrl: String,
    pageUrl: String,
    onPlayerClosed: () -> Unit = {}  // –ù–û–í–´–ô –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–∫—Ä—ã—Ç–∏–∏
)
```

**–ó–∞—á–µ–º:** –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–ª–µ–µ—Ä—É —Å–æ–æ–±—â–∏—Ç—å –≤–Ω–µ—à–Ω–µ–º—É –º–∏—Ä—É, —á—Ç–æ –æ–Ω –∑–∞–≤–µ—Ä—à–∏–ª –æ—á–∏—Å—Ç–∫—É —Ä–µ—Å—É—Ä—Å–æ–≤.

#### 1.2 –í—ã–∑—ã–≤–∞—Ç—å callback –ø–æ—Å–ª–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤

```kotlin
DisposableEffect(Unit) {
    onDispose {
        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        handler.removeCallbacksAndMessages(null)

        // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º —Ä–µ—Å—É—Ä—Å—ã –ø–ª–µ–µ—Ä–∞
        exoPlayer.release()

        // –ù–û–í–û–ï: —É–≤–µ–¥–æ–º–ª—è–µ–º –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –æ—á–∏—Å—Ç–∫–∏
        onPlayerClosed()
    }
}
```

**–í–∞–∂–Ω–æ:** Callback –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è **–ø–æ—Å–ª–µ** `exoPlayer.release()`, –∫–æ–≥–¥–∞ –≤—Å–µ —Ä–µ—Å—É—Ä—Å—ã —É–∂–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω—ã.

---

### –≠—Ç–∞–ø 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è Closing –≤ PlayerViewModel

**–§–∞–π–ª:** `PlayerViewModel.kt`

#### 2.1 –†–∞—Å—à–∏—Ä–∏—Ç—å sealed interface

```kotlin
sealed interface PlayerUiState {
    object Loading : PlayerUiState
    data class Success(val videoUrl: String, val pageUrl: String) : PlayerUiState
    object Closing : PlayerUiState  // –ù–û–í–û–ï: —Ñ–∞–∑–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–ª–µ–µ—Ä–∞
    data class Error(val message: String) : PlayerUiState
}
```

#### 2.2 –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ –¥–ª—è –∏–Ω–∏—Ü–∏–∞—Ü–∏–∏ –∑–∞–∫—Ä—ã—Ç–∏—è

```kotlin
class PlayerViewModel(
    encodedPageUrl: String,
    private val repository: ContentRepository
) : ViewModel() {

    // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...

    /**
     * –ò–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–∫—Ä—ã—Ç–∏—è –ø–ª–µ–µ—Ä–∞
     * –ü–µ—Ä–µ–≤–æ–¥–∏—Ç UI –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ Closing –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤
     */
    fun initiateClosing() {
        Log.d(TAG, "üö™ –ò–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω–æ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–ª–µ–µ—Ä–∞")
        _uiState.value = PlayerUiState.Closing
    }

    /**
     * –í—ã–∑—ã–≤–∞–µ—Ç—Å—è PlayerScreen –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–≥–æ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
     */
    fun onPlayerFullyClosed() {
        Log.d(TAG, "‚úÖ –ü–ª–µ–µ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä—ã—Ç, —Ä–µ—Å—É—Ä—Å—ã –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω—ã")
    }
}
```

**–õ–æ–≥–∏–∫–∞:**
1. `initiateClosing()` - –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç UI –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `Closing`
2. PlayerScreen –≤–∏–¥–∏—Ç –Ω–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ‚Üí –Ω–∞—á–∏–Ω–∞–µ—Ç –æ—á–∏—Å—Ç–∫—É
3. `onPlayerFullyClosed()` - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (–¥–ª—è –ª–æ–≥–æ–≤/–º–µ—Ç—Ä–∏–∫)

---

### –≠—Ç–∞–ø 3: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è Closing –≤ MainActivity

**–§–∞–π–ª:** `MainActivity.kt:240-257`

#### 3.1 –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –Ω–æ–≤–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

```kotlin
when (val state = uiState) {
    is PlayerUiState.Loading -> {
        Box(
            contentAlignment = Alignment.Center,
            modifier = Modifier.fillMaxSize().background(Color.Black)
        ) {
            CircularProgressIndicator()
        }
    }
    is PlayerUiState.Success -> {
        PlayerScreen(
            videoUrl = state.videoUrl,
            pageUrl = state.pageUrl,
            onPlayerClosed = {
                // –ü–ª–µ–µ—Ä —Å–æ–æ–±—â–∞–µ—Ç, —á—Ç–æ —Ä–µ—Å—É—Ä—Å—ã –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω—ã
                viewModel.onPlayerFullyClosed()

                // –ö–†–ò–¢–ò–ß–ù–û: –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ü–û–°–õ–ï –ø–æ–ª–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏
                navController.popBackStack()
            }
        )
    }
    is PlayerUiState.Closing -> {
        // –ù–û–í–û–ï: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —á–µ—Ä–Ω—ã–π —ç–∫—Ä–∞–Ω –≤–æ –≤—Ä–µ–º—è –∑–∞–∫—Ä—ã—Ç–∏—è
        Box(
            modifier = Modifier
                .fillMaxSize()
                .background(Color.Black)
        )
        // PlayerScreen –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω –∏–∑ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ ‚Üí –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è onDispose
    }
    is PlayerUiState.Error -> {
        Box(contentAlignment = Alignment.Center, modifier = Modifier.fillMaxSize()) {
            Text("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ: ${state.message}")
        }
    }
}
```

**–í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:**
- `Closing` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç **–ø–æ–ª–Ω–æ—Å—Ç—å—é —á–µ—Ä–Ω—ã–π —ç–∫—Ä–∞–Ω** –±–µ–∑ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- `navController.popBackStack()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ** `onPlayerClosed()`
- –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –ø–µ—Ä–µ—Ö–æ–¥ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏

---

### –≠—Ç–∞–ø 4: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" –≤ PlayerScreen

**–§–∞–π–ª:** `PlayerScreen.kt`

#### 4.1 –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ Back

```kotlin
@Composable
fun PlayerScreen(
    videoUrl: String,
    pageUrl: String,
    onPlayerClosed: () -> Unit = {},
    onBackPressed: () -> Unit = {}  // –ù–û–í–û–ï: –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è "–ù–∞–∑–∞–¥"
)
```

#### 4.2 –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–∏—Å—Ç–µ–º–Ω–æ–π –∫–Ω–æ–ø–∫–∏ Back

```kotlin
import androidx.activity.compose.BackHandler

@Composable
fun PlayerScreen(
    videoUrl: String,
    pageUrl: String,
    onPlayerClosed: () -> Unit,
    onBackPressed: () -> Unit
) {
    // –ù–û–í–û–ï: –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º —Å–∏—Å—Ç–µ–º–Ω—É—é –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
    BackHandler {
        onBackPressed()
    }

    // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ PlayerScreen ...
}
```

**–ó–∞—á–µ–º:** –ü–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ, –∑–∞–ø—É—Å—Ç–∏–≤ –ø—Ä–æ—Ü–µ—Å—Å –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è.

#### 4.3 –û–±–Ω–æ–≤–∏—Ç—å –≤—ã–∑–æ–≤ –≤ MainActivity

```kotlin
is PlayerUiState.Success -> {
    PlayerScreen(
        videoUrl = state.videoUrl,
        pageUrl = state.pageUrl,
        onBackPressed = {
            // –ò–Ω–∏—Ü–∏–∏—Ä—É–µ–º –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ
            viewModel.initiateClosing()
        },
        onPlayerClosed = {
            viewModel.onPlayerFullyClosed()
            navController.popBackStack()
        }
    )
}
```

---

## –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Ç–æ–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –¢–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ (–±–∞–≥):
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ù–∞–∑–∞–¥"
    ‚Üì
navController.popBackStack() (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ)
    ‚Üì
PlayerScreen —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏
    ‚Üì
onDispose ‚Üí exoPlayer.release() (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)
    ‚ïë
    ‚ïë –í —ç—Ç–æ –∂–µ –≤—Ä–µ–º—è:
    ‚ïë
    ‚Üì
GalleryScreen –ø–æ—è–≤–ª—è–µ—Ç—Å—è –Ω–∞ —ç–∫—Ä–∞–Ω–µ
    ‚Üì
–ù–ê–õ–û–ñ–ï–ù–ò–ï: –í–∏–¥–µ–Ω –∏ –ø–ª–µ–µ—Ä, –∏ –≥–∞–ª–µ—Ä–µ—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
```

### –ù–æ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ):
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ù–∞–∑–∞–¥"
    ‚Üì
viewModel.initiateClosing()
    ‚Üì
uiState = Closing
    ‚Üì
MainActivity –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —á–µ—Ä–Ω—ã–π —ç–∫—Ä–∞–Ω
    ‚Üì
PlayerScreen —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏
    ‚Üì
onDispose ‚Üí exoPlayer.release()
    ‚Üì
onPlayerClosed() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
    ‚Üì
viewModel.onPlayerFullyClosed()
    ‚Üì
navController.popBackStack() ‚Üê –¢–ï–ü–ï–†–¨ –ó–î–ï–°–¨
    ‚Üì
GalleryScreen –ø–æ—è–≤–ª—è–µ—Ç—Å—è –Ω–∞ —á–∏—Å—Ç–æ–º –º–µ—Å—Ç–µ
    ‚Üì
‚úÖ –ü–õ–ê–í–ù–´–ô –ü–ï–†–ï–•–û–î –ë–ï–ó –ù–ê–õ–û–ñ–ï–ù–ò–Ø
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑–æ–≤–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è
1. –û—Ç–∫—Ä—ã—Ç—å –ª—é–±–æ–µ –≤–∏–¥–µ–æ –∏–∑ –≥–∞–ª–µ—Ä–µ–∏
2. –î–æ–∂–¥–∞—Ç—å—Å—è –Ω–∞—á–∞–ª–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
3. –ù–∞–∂–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω—É—é –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
4. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - –ü–æ—è–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–Ω—ã–π —ç–∫—Ä–∞–Ω
   - –ß–µ—Ä–µ–∑ ~100-300ms –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≥–∞–ª–µ—Ä–µ—è
   - –ù–ï–¢ –Ω–∞–ª–æ–∂–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è
1. –û—Ç–∫—Ä—ã—Ç—å –≤–∏–¥–µ–æ
2. **–ù–ï –¥–æ–∂–∏–¥–∞—è—Å—å –∑–∞–≥—Ä—É–∑–∫–∏** –Ω–∞–∂–∞—Ç—å "–ù–∞–∑–∞–¥" (—Å–æ—Å—Ç–æ—è–Ω–∏–µ `Loading`)
3. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç (–Ω–µ—Ç –ø–ª–µ–µ—Ä–∞ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏)
   - –ë–µ–∑ –æ—à–∏–±–æ–∫

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–µ
1. –î–æ–±–∞–≤–∏—Ç—å –≤ JSON –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π `pageUrl` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `https://invalid-url.com`)
2. –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –æ—Ç–∫—Ä—ã—Ç—å ‚Üí –ø–æ—è–≤–∏—Ç—Å—è –æ—à–∏–±–∫–∞
3. –ù–∞–∂–∞—Ç—å "–ù–∞–∑–∞–¥"
4. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–∞–ª–µ—Ä–µ—é
   - –ë–µ–∑ –∫—Ä–∞—à–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –®–∞–≥ 4: –°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç
1. –ë—ã—Å—Ç—Ä–æ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –∏ –∑–∞–∫—Ä—ã–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –≤–∏–¥–µ–æ –ø–æ–¥—Ä—è–¥ (5-10 —Ä–∞–∑)
2. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - –ö–∞–∂–¥—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –ø–ª–∞–≤–Ω—ã–π
   - –ù–µ—Ç —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏ (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ Android Profiler)
   - –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
     ```
     üö™ –ò–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω–æ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–ª–µ–µ—Ä–∞
     ‚úÖ –ü–ª–µ–µ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä—ã—Ç, —Ä–µ—Å—É—Ä—Å—ã –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω—ã
     ```

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–ª–µ–µ—Ä–∞ –≤ Logcat –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ç–∞–∫–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

```
D/PlayerDebug: üö™ –ò–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω–æ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–ª–µ–µ—Ä–∞
D/PlayerDebug: ‚úÖ –ü–ª–µ–µ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä—ã—Ç, —Ä–µ—Å—É—Ä—Å—ã –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω—ã
```

**–ï—Å–ª–∏ –ø–æ—Ä—è–¥–æ–∫ –Ω–∞—Ä—É—à–µ–Ω** - –∑–Ω–∞—á–∏—Ç –µ—Å—Ç—å race condition!

---

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è (–æ—Ç–∫–ª–æ–Ω–µ–Ω—ã)

### ‚ùå –í–∞—Ä–∏–∞–Ω—Ç 1: –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É –ø–µ—Ä–µ–¥ popBackStack()
```kotlin
Handler(Looper.getMainLooper()).postDelayed({
    navController.popBackStack()
}, 300)
```

**–ü–æ—á–µ–º—É –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ:**
- –ú–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞ (300ms) - –Ω–µ–Ω–∞–¥–µ–∂–Ω–æ
- –ù–∞ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
- –ù–∞ –±—ã—Å—Ç—Ä—ã—Ö - –∏–∑–±—ã—Ç–æ—á–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
- –ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ `exoPlayer.release()`

### ‚ùå –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Animated Navigation
```kotlin
AnimatedNavHost {
    fadeOut(animationSpec = tween(500))
}
```

**–ü–æ—á–µ–º—É –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ:**
- –ù–µ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É - —Ç–æ–ª—å–∫–æ –º–∞—Å–∫–∏—Ä—É–µ—Ç –µ—ë –∞–Ω–∏–º–∞—Ü–∏–µ–π
- –†–µ—Å—É—Ä—Å—ã –≤—Å—ë —Ä–∞–≤–Ω–æ –æ—Å–≤–æ–±–æ–∂–¥–∞—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
- –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –≤—Ä–µ–º—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### ‚úÖ –í—ã–±—Ä–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –°–æ—Å—Ç–æ—è–Ω–∏–µ Closing —Å callback
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ **–¥–æ** –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∞–π–º–µ—Ä–æ–≤
- –†–∞–±–æ—Ç–∞–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ –Ω–∞ –ª—é–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
- –Ø–≤–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –ø–æ—Ç–æ–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

---

## –†–∏—Å–∫–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

‚ö†Ô∏è **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã `onDispose`**
- –ï—Å–ª–∏ Compose –Ω–µ –≤—ã–∑–æ–≤–µ—Ç `onDispose` –ø–æ –∫–∞–∫–æ–π-—Ç–æ –ø—Ä–∏—á–∏–Ω–µ, –Ω–∞–≤–∏–≥–∞—Ü–∏—è –∑–∞–≤–∏—Å–Ω–µ—Ç
- –†–µ—à–µ–Ω–∏–µ: –¥–æ–±–∞–≤–∏—Ç—å timeout –≤ Production-–≤–µ—Ä—Å–∏–∏ (—á–µ—Ä–µ–∑ `Handler.postDelayed` –∫–∞–∫ fallback)

‚ö†Ô∏è **–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–∫—Ä—ã—Ç–∏—è –Ω–∞ ~100-200ms**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–º–µ—Ç–∏—Ç –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É
- –†–µ—à–µ–Ω–∏–µ: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —á–µ—Ä–Ω—ã–π —ç–∫—Ä–∞–Ω (–≤–∏–∑—É–∞–ª—å–Ω–æ –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º –Ω–∞–ª–æ–∂–µ–Ω–∏–µ)

‚ö†Ô∏è **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–¥ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**
- –£—Å–ª–æ–∂–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- –†–µ—à–µ–Ω–∏–µ: —Ç—â–∞—Ç–µ–ª—å–Ω–æ–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ç–µ—Å—Ç—ã

---

## –ß–µ–∫–ª–∏—Å—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- [ ] **–≠—Ç–∞–ø 1:** –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `onPlayerClosed` –≤ `PlayerScreen.kt`
- [ ] **–≠—Ç–∞–ø 1:** –í—ã–∑—ã–≤–∞—Ç—å callback –≤ `onDispose` –ø–æ—Å–ª–µ `exoPlayer.release()`
- [ ] **–≠—Ç–∞–ø 2:** –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ `Closing` –≤ `PlayerUiState`
- [ ] **–≠—Ç–∞–ø 2:** –°–æ–∑–¥–∞—Ç—å –º–µ—Ç–æ–¥ `initiateClosing()` –≤ `PlayerViewModel`
- [ ] **–≠—Ç–∞–ø 2:** –°–æ–∑–¥–∞—Ç—å –º–µ—Ç–æ–¥ `onPlayerFullyClosed()` –≤ `PlayerViewModel`
- [ ] **–≠—Ç–∞–ø 3:** –û–±—Ä–∞–±–æ—Ç–∞—Ç—å `Closing` –≤ `MainActivity` (–ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —á–µ—Ä–Ω—ã–π —ç–∫—Ä–∞–Ω)
- [ ] **–≠—Ç–∞–ø 3:** –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å `popBackStack()` –≤ callback `onPlayerClosed`
- [ ] **–≠—Ç–∞–ø 4:** –î–æ–±–∞–≤–∏—Ç—å `BackHandler` –≤ `PlayerScreen`
- [ ] **–≠—Ç–∞–ø 4:** –°–≤—è–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥" —Å `viewModel.initiateClosing()`
- [ ] **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ 5 —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- [ ] **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –ª–æ–≥–∞—Ö
- [ ] **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∫–æ–¥–µ

---

## –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
- ‚úÖ –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–ù–∞–∑–∞–¥" –ø–ª–µ–µ—Ä —Å–Ω–∞—á–∞–ª–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –∑–∞—Ç–µ–º –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≥–∞–ª–µ—Ä–µ—è
- ‚úÖ –ù–µ—Ç –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –Ω–∞–ª–æ–∂–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
- ‚úÖ –ü–µ—Ä–µ—Ö–æ–¥ –≤—ã–≥–ª—è–¥–∏—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ (—á–µ—Ä–Ω—ã–π —ç–∫—Ä–∞–Ω ‚Üí –≥–∞–ª–µ—Ä–µ—è)
- ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ ExoPlayer –¥–æ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
